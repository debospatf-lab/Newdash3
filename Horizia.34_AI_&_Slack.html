<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HORIZIA PB testing Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>  
<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<style>
    :root{ --accent:#2563eb; --muted:#475569; }
    body {
      font-family: Inter, Arial, sans-serif;
      background: #ffffff;
      color: #1e293b;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #ffffff;
      padding: 14px 20px;
      display: flex;
      gap:12px;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
      flex-wrap: wrap;
    }
    header h1{ margin:0; font-size:20px; color:var(--accent); }
    header img{ width:100px }
    .datetime{ font-size:13px; color:var(--muted) }

    .container{
      max-width:1200px; margin:28px auto; padding:0 20px; flex-grow:1;
    }
    .integrations{
      display:flex; gap:12px; align-items:center; justify-content:center; background:#fbfdff; padding:18px; border-radius:10px; box-shadow: 0 4px 14px rgba(0,0,0,0.04);
    }
    .integration { background:#fff; padding:16px; border-radius:8px; min-width:200px; text-align:center; box-shadow:0 6px 12px rgba(0,0,0,0.04) }

    .grid{ display:flex; gap:18px; flex-wrap:wrap; margin-top:20px; }
    .card{ background:#ffffff; padding:16px; border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,0.06); text-align:center; flex:1; min-width:220px; }
    .card h2{ margin:8px 0 }
    button{ margin-top:10px; padding:8px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:600; background:var(--accent); color:white }
    button.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(37,99,235,0.12) }
    button.header-btn { margin: 0; padding: 8px 18px; font-size: 16px; }

    .body-actions { /* New actions bar under header */ display: flex; gap: 10px; margin: 20px 0 0 0; flex-wrap: wrap; }

    footer{ text-align:center; padding:18px; font-size:13px; background:#ffffff; color:var(--muted); box-shadow:0 -4px 8px rgba(0,0,0,0.04) }

    .modal{ display:none; position:fixed; z-index:1000; left:0;top:0;width:100%;height:100%; background: rgba(0,0,0,0.45); justify-content:center; align-items:center }
    .modal-content{ background:#fff; padding:18px; border-radius:12px; max-width:1000px; width:96%; color:#0f172a; box-shadow:0 8px 28px rgba(2,6,23,0.2); max-height:90vh; overflow:auto }
    .modal-header{ display:flex; align-items:center; justify-content:space-between }
    .close{ cursor:pointer; font-size:22px; color:var(--muted) }

    #loginPage{ display:none; height:100vh; align-items:center; justify-content:center; background: linear-gradient(180deg,#f8fafc,#ffffff); position:fixed; top:0; left:0; width:100%; z-index:100; }
    .login-box{ background:#fff; padding:24px; border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.06); width:360px }
    .input{ width:100%; padding:10px; border-radius:8px; border:1px solid #e6eef9; margin-bottom:10px }

    #chatbox{ position:fixed; bottom:18px; right:18px; width:320px; background:#ffffff; border-radius:12px; box-shadow:0 6px 20px rgba(2,6,23,0.12); display:flex; flex-direction:column; overflow:hidden; z-index:2000 }
    #chatbox-header{ background:var(--accent); color:white; padding:10px; font-weight:700; cursor:pointer }
    #chatbox-messages{ padding:10px; max-height:300px; overflow:auto; font-size:14px }
    .msg{ margin:6px 0 }
    .user{ text-align:right; color:var(--accent) }
    .ai{ text-align:left; color:var(--muted) }
    #chatbox-input{ display:flex; border-top:1px solid #eef2ff }
    #chatbox-input input{ flex:1; padding:10px; border:0; outline:none }

    .heatmap{ display:grid; grid-template-columns: repeat(6,40px); gap:6px; justify-content:center; }
    .heatcell{ width:40px; height:40px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:11px; color:white }

    .map-canvas{ width:100%; height:420px; background:linear-gradient(180deg,#fbfdff,#fff); border-radius:8px; padding:12px; box-sizing:border-box }

    table{ width:100%; border-collapse:collapse }
    th,td{ padding:8px; border-bottom:1px solid #eef2ff; text-align:left }

    /* Landing Page Styles */
    #landingPage {
      min-height: 100vh;
      /*background: #f8fafc;*/
      background-image: url("whitebackground.PNG");
      display: flex;
      flex-direction: column;
    }
    .landing-header {
      background: #fff;
      box-shadow: 0 4px 14px rgba(0,0,0,0.03);
      padding: 22px 0 12px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    .landing-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .landing-logo img {
      width: 150px;
      height: 150px;
      object-fit: contain;
    }
    .landing-title {
      font-size: 2rem;
      color: var(--accent);
      letter-spacing: 1px;
      font-weight: 700;
      margin-left: 10px;
    }
    .get-started-btn {
      background-color: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      font-weight: 600;
      padding: 12px 32px;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(2,6,23,0.06);
    }
    .get-started-btn:hover {
      background-color: #174baf;
    }
    .landing-main {
      max-width: 900px;
      margin: 38px auto 0 auto;
      padding: 0 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .points-list {
      display: flex;
      flex-direction: column;
      gap: 28px;
      margin-top: 30px;
      margin-bottom: 42px;
    }
    .point-item {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      background: #fff;
      border-radius: 10px;
      padding: 18px 22px;
      box-shadow: 0 2px 12px rgba(2,6,23,0.04);
    }
    .point-icon {
      flex-shrink: 0;
      font-size: 2.1rem;
      margin-right: 4px;
      color: var(--accent);
      margin-top: 3px;
    }
    .point-content {
      display: flex;
      flex-direction: column;
    }
    .point-title {
      font-weight: 700;
      font-size: 1.15rem;
      margin-bottom: 3px;
    }
    .point-desc {
      color: var(--muted);
      font-size: 15px;
      line-height: 1.45;
    }
    .landing-footer {
      background: #fff;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      padding: 20px 0 14px 0;
      margin-top: auto;
      box-shadow: 0 -3px 10px rgba(0,0,0,0.03);
    }
    @media (max-width:800px){
      .integrations{ flex-direction:column }
      .landing-main { padding: 0 6px; }
      .point-item { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <!-- LANDING PAGE -->
  <div id="landingPage">
    <div class="landing-header">
      <div class="landing-logo">
        <img src="HORIZIA1.png" alt="HORIZIA Logo" onerror="this.style.display='none'" />
        <span class="landing-title"></span>
      </div>
      <button class="get-started-btn" onclick="showLoginPage()">Get Started</button>
    </div>
    <div class="landing-main">
      <h2 style="margin-bottom:12px; color:var(--accent); font-size:1.7rem; letter-spacing:0.5px; text-align:center;">The Next-Gen Team Collaboration Dashboard</h2>
      <div class="points-list">
        <div class="point-item">
          <span class="point-icon">üîó</span>
          <div class="point-content">
            <span class="point-title">Integrate Jira, GitHub, and Slack for Collaboration</span>
            <span class="point-desc">Bring all your project management, version control, and communication into a single dashboard for enhanced team transparency and productivity.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üìÖ</span>
          <div class="point-content">
            <span class="point-title">Yearly Delivery Roadmap</span>
            <span class="point-desc">Visualize project milestones and releases across the year, ensuring everyone stays aligned on what's next.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üó∫Ô∏è</span>
          <div class="point-content">
            <span class="point-title">Cross-Team Dependency Map</span>
            <span class="point-desc">See how teams and modules depend on each other, making it easy to manage cross-functional dependencies.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üî•</span>
          <div class="point-content">
            <span class="point-title">Blockers Heat Map</span>
            <span class="point-desc">Easily spot where issues are concentrated and address bottlenecks before they slow down your team.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">‚ö†Ô∏è</span>
          <div class="point-content">
            <span class="point-title">Risk Indicators & Alerts</span>
            <span class="point-desc">Stay ahead of trouble with automated risk detection and proactive alerts for critical issues.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üìä</span>
          <div class="point-content">
            <span class="point-title">Product Status Circular Chart</span>
            <span class="point-desc">Monitor the overall health and progress of your product at a glance with a visually striking circular chart.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üë•</span>
          <div class="point-content">
            <span class="point-title">User Groups & Roles</span>
            <span class="point-desc">Assign roles like Product Owner, Team Lead, Project Manager, Engineering Manager, or <b>Admin</b> for secure, role-based access and permissions.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">üîí</span>
          <div class="point-content">
            <span class="point-title">Secure Access Management</span>
            <span class="point-desc">Robust authentication ensures that only authorized users can access and manage sensitive project data.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">ü§ñ</span>
          <div class="point-content">
            <span class="point-title">Built-in AI Chatbot</span>
            <span class="point-desc">Get instant answers to project questions and guidance on using dashboard features with our integrated AI assistant.</span>
          </div>
        </div>
        <div class="point-item">
          <span class="point-icon">‚òÅÔ∏è</span>
          <div class="point-content">
            <span class="point-title">Modern White-Themed Design</span>
            <span class="point-desc">Enjoy a clean, modern interface designed for clarity and focus‚Äîmostly white backgrounds keep your attention on what matters.</span>
          </div>
        </div>
      </div>
    </div>
    <div class="landing-footer">
      <span>¬© 2025 HORIZIA ‚Äî Powering smarter, transparent team collaboration</span>
    </div>
  </div>

  <!-- LOGIN PAGE -->
  <div id="loginPage">
    <div class="login-box">
      <h3 style="margin:0 0 10px 0; color:var(--accent)">HORIZIA ‚Äî Sign in</h3>
      <input id="inpUser" class="input" placeholder="Email" />
      <input id="inpPass" type="password" class="input" placeholder="Password" />
      <label style="display:block; margin:8px 0; color:var(--muted)">Select role:</label>
      <select id="inpRole" class="input">
        <option>Product Owner</option>
        <option>Team Lead</option>
        <option>Project Manager</option>
        <option>Engineering Manager</option>
        <option>Admin</option>
      </select>
      <button style="width:100%" onclick="doLogin()">Sign in</button>
      <button class="ghost" style="width:100%; margin-top:8px;" onclick="doSignup()">Sign up</button>
      <button class="ghost" style="width:100%; margin-top:8px;" onclick="doPasswordReset()">Forgot Password?</button>
      <p style="font-size:13px; color:var(--muted); margin-top:8px">User authentication powered by Firebase Auth. Roles are assigned on sign up.</p>
      <button class="ghost" style="margin: 10px auto 0 auto; display: block" onclick="goToLanding()">Back to Landing</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" style="display:none;">
    <header>
      <div style="display:flex; gap:12px; align-items:center">
        <img src="HORIZIA1.png" alt="logo" onerror="this.style.display='none'" />
        <h1>Collaboration Dashboard</h1>
        <div class="datetime" id="datetime"></div>
      </div>
      <div style="display:flex; gap:10px; align-items:center">
        <div id="userRole" style="font-size:13px; font-weight:700"></div>
        <button class="ghost" onclick="openModal('users')">User Management</button>
        <button onclick="logout()">Logout</button>
      </div>
    </header>

    <!-- BODY-ONLY action bar for delivery/dep/blockers/risk -->
    <div class="container">
      <div class="body-actions" id="bodyActions">
        <button class="ghost" onclick="openModal('roadmap')">Delivery Roadmap</button>
        <button class="ghost" onclick="openModal('dependencies')">Cross-team Map</button>
        <button class="ghost" onclick="openModal('blockers')">Blockers Heatmap</button>
        <button class="ghost" onclick="openModal('risks')">Risk Alerts</button>
      </div>

      <!-- Landing area shows Jira, GitHub, Slack horizontally -->
      <div class="integrations">
        <div class="integration">
          <h3>Jira</h3>
          <p style="margin:6px 0">Issues, sprints & backlog</p>
          <button onclick="openModal('jira')">Connect Jira</button>
        </div>
        <div class="integration">
          <h3>GitHub</h3>
          <p style="margin:6px 0">PRs, commits & branches</p>
          <button onclick="openModal('github')">Connect GitHub</button>
        </div>
        <div class="integration">
          <h3>Slack</h3>
          <p style="margin:6px 0">Channels & alerts</p>
          <button onclick="openModal('slack')">Connect Slack</button>
        </div>
      </div>

      <!-- Main cards -->
      <div class="grid">
        <div class="card role-all">
          <h2>üìä Product Status</h2>
          <p>High-level product health and completion</p>
          <canvas id="productStatus" width="260" height="160"></canvas>
          <button onclick="openModal('product-status')">View</button>
        </div>

        <div class="card role-all">
          <h2>üî• Blockers Heatmap</h2>
          <p>Where issues are concentrated</p>
          <div style="height:80px; display:flex; align-items:center; justify-content:center">
            <div style="width:180px;">
              <div id="miniHeat" class="heatmap" aria-hidden="true"></div>
            </div>
          </div>
          <button onclick="openModal('blockers')">Open Heatmap</button>
        </div>

        <div class="card role-all">
          <h2>üîó Cross-team Dependencies</h2>
          <p>Visual dependency map</p>
          <div style="height:80px; display:flex; align-items:center; justify-content:center">
            <svg width="180" height="80">
              <circle cx="30" cy="40" r="12" fill="#e6f0ff"></circle>
              <text x="30" y="44" text-anchor="middle" font-size="10">Team A</text>
              <circle cx="90" cy="20" r="12" fill="#fff4e6"></circle>
              <text x="90" y="24" text-anchor="middle" font-size="10">Team B</text>
              <circle cx="150" cy="40" r="12" fill="#f3e6ff"></circle>
              <text x="150" y="44" text-anchor="middle" font-size="10">Team C</text>
              <line x1="42" y1="40" x2="78" y2="24" stroke="#c3d8ff" stroke-width="2"/>
              <line x1="102" y1="26" x2="138" y2="40" stroke="#ffd9b3" stroke-width="2"/>
            </svg>
          </div>
          <button onclick="openModal('dependencies')">Open Map</button>
        </div>
      </div>

      <!-- Role-specific sample card -->
      <div class="grid" style="margin-top:18px">
        <div class="card role-po role-pm role-admin">
          <h2>üìå Roadmap</h2>
          <p>Yearly milestones and releases</p>
          <button onclick="openModal('roadmap')">Open Roadmap</button>
        </div>

        <div class="card role-tl role-em role-admin">
          <h2>‚ö† Risk Indicators</h2>
          <p>Alerts when thresholds exceed limits</p>
          <button onclick="openModal('risks')">View Risks</button>
        </div>

        <div class="card role-all">
          <h2>ü§ñ AI Assistant</h2>
          <p>Ask about project status, blockers, or dependencies</p>
          <button onclick="toggleChat();">Open Chat</button>
        </div>
      </div>
    </div>
    <footer>
      <p>¬© 2025 HORIZIA ‚Äî Team Collaboration Dashboard</p>
    </footer>
  </div>

  <!-- GLOBAL MODAL -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content" id="modalContent">
      <div class="modal-header">
        <h3 id="modalTitle">Modal</h3>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- AI Chatbox -->
  <div id="chatbox" style="display:none;">
    <div id="chatbox-header" onclick="toggleChat()">ü§ñ AI Assistant</div>
    <div id="chatbox-messages"></div>
    <div id="chatbox-input">
      <input id="chatInput" placeholder="Ask me about the project..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    // ---------------------- FIREBASE CONFIG ----------------------
    // TODO: Replace below with your Firebase project's config object:
    const firebaseConfig = {
      apiKey: "AIzaSyD4HY2aDRhuWrhTnhlvOIP5_lLRXUKLk4Q",
      authDomain: "horizia-9334b.firebaseapp.com",
      projectId: "horizia-9334b",
      // ... other config
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ---------------------- GLOBAL STATE ----------------------
    let chatOpen = false;

    // ---------------------- AUTH + ROLES ----------------------
    // User roles are stored in localStorage using email as key.
    // On signup, store role in localStorage: horizia_role_{email}
    // On login, retrieve role from localStorage.
    function doLogin(){
      const email = document.getElementById('inpUser').value.trim();
      const password = document.getElementById('inpPass').value;
      if(!email || !password) return alert('Provide email and password.');
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          // Get role from localStorage
          const role = localStorage.getItem('horizia_role_' + email);
          if(!role) {
            alert('No role found for this account. Please sign up again.');
            logout();
            return;
          }
          localStorage.setItem('horizia_current_user', JSON.stringify({email: user.email, role}));
          showDashboard();
        })
        .catch(error => {
          alert('Login error: ' + error.message);
        });
    }

    function doSignup(){
      const email = document.getElementById('inpUser').value.trim();
      const password = document.getElementById('inpPass').value;
      const role = document.getElementById('inpRole').value;
      if(!email || !password) return alert('Provide email and password.');
      if(!role) return alert('Select a role.');
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          // Store role in localStorage
          localStorage.setItem('horizia_role_' + email, role);
          localStorage.setItem('horizia_current_user', JSON.stringify({email, role}));
          showDashboard();
        })
        .catch(error => {
          if(error.code === 'auth/email-already-in-use'){
            alert('Email already in use. Please log in.');
          }else{
            alert('Signup error: ' + error.message);
          }
        });
    }

    // -------- PASSWORD RESET FUNCTION --------
    function doPasswordReset(){
      const email = document.getElementById('inpUser').value.trim();
      if(!email) return alert('Please enter your email in the field above to reset your password.');
      auth.sendPasswordResetEmail(email)
        .then(function() {
          alert('Password reset email sent to ' + email + '. Please check your inbox.');
        })
        .catch(function(error) {
          alert('Error sending password reset email: ' + error.message);
        });
    }

    function logout(){
      auth.signOut().then(()=>{
        localStorage.removeItem('horizia_current_user');
        hideAllMainScreens();
        showLandingPage();
      });
    }

    function getCurrentUser(){ 
      try{ return JSON.parse(localStorage.getItem('horizia_current_user')||'null'); }
      catch(e){ return null; } 
    }

    function showDashboard(){
      hideAllMainScreens();
      document.getElementById('dashboard').style.display='block';
      const user = getCurrentUser();
      if(!user) return showLandingPage();
      document.getElementById('userRole').textContent = `${user.email} ‚Äî ${user.role}`;
      document.querySelectorAll('.card').forEach(c=>c.style.display='none');
      const roleClasses = {
        'Product Owner':['role-po','role-all'],
        'Team Lead':['role-tl','role-all'],
        'Project Manager':['role-pm','role-all'],
        'Engineering Manager':['role-em','role-all'],
        'Admin':['role-admin','role-po','role-tl','role-pm','role-em','role-all'] // Admin gets all cards
      };
      const classes = roleClasses[user.role]||['role-all'];
      classes.forEach(cl=> document.querySelectorAll('.'+cl).forEach(el=>el.style.display='block'));
      document.querySelectorAll('.role-all').forEach(el=>el.style.display='block');
      renderMiniHeat();
      drawProductChart();
      const userMgmtBtn = Array.from(document.querySelectorAll('button.ghost')).find(b=> (b.getAttribute('onclick')||'').includes("openModal('users')"));
      if(userMgmtBtn){ 
        // Only Project Manager and Admin see user management button
        userMgmtBtn.style.display = (user.role === 'Project Manager' || user.role === 'Admin') ? 'inline-block' : 'none'; 
      }
    }

    function hideAllMainScreens(){
      document.getElementById('landingPage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('dashboard').style.display = 'none';
    }

    function showLoginPage(){
      hideAllMainScreens();
      document.getElementById('loginPage').style.display='flex';
    }
    function goToLanding(){
      hideAllMainScreens();
      showLandingPage();
    }
    function showLandingPage(){
      hideAllMainScreens();
      document.getElementById('landingPage').style.display='flex';
    }

    // ---------------------- DATETIME ----------------------
    function updateDateTime(){ const now=new Date(); const opts={weekday:'short',year:'numeric',month:'short',day:'numeric'}; document.querySelectorAll('.datetime').forEach(el=>el.textContent = now.toLocaleDateString(undefined,opts)+' | '+now.toLocaleTimeString()); }

    // ---------------------- MODALS CONTENT ----------------------
    function openModal(key){
      const title = document.getElementById('modalTitle');
      const body = document.getElementById('modalBody');
      const modal = document.getElementById('modal');
      body.innerHTML = '';
      if(key==='jira'){ title.textContent='Connect Jira'; body.innerHTML = '<p>Provide Jira Base URL and API token (demo only).</p><input class="input" id="jiraUrl" placeholder="https://your-domain.atlassian.net" /><input class="input" id="jiraToken" placeholder="API token" /><button onclick="saveIntegration(\'jira\')">Save</button>' }
      else if(key==='github'){ title.textContent='Connect GitHub'; body.innerHTML = '<p>Provide GitHub personal access token (demo only).</p><input class="input" id="ghToken" placeholder="ghp_..." /><button onclick="saveIntegration(\'github\')">Save</button>' }
      else if(key==='slack'){ title.textContent='Connect Slack'; body.innerHTML = '<p>Provide Slack Bot token (demo only).</p><input class="input" id="slackToken" placeholder="xoxb-..." /><button onclick="saveIntegration(\'slack\')">Save</button>' }

      else if(key==='roadmap'){
        title.textContent='Delivery Roadmap ‚Äî 2025';
        body.innerHTML = `<p style='color:var(--muted)'>Quarterly milestones and release windows (editable).</p>
          <div style='display:flex; gap:12px; flex-wrap:wrap'>
            <div style='flex:1; min-width:200px; background:#f8fbff; padding:12px; border-radius:8px'>
              <strong>Q1</strong><ul><li>Discovery</li><li>Alpha</li></ul>
            </div>
            <div style='flex:1; min-width:200px; background:#fff7f2; padding:12px; border-radius:8px'>
              <strong>Q2</strong><ul><li>Beta</li><li>Integrations</li></ul>
            </div>
            <div style='flex:1; min-width:200px; background:#f3f9f3; padding:12px; border-radius:8px'>
              <strong>Q3</strong><ul><li>Release Candidate</li><li>Scale</li></ul>
            </div>
            <div style='flex:1; min-width:200px; background:#fff6ff; padding:12px; border-radius:8px'>
              <strong>Q4</strong><ul><li>GA</li><li>Post-launch</li></ul>
            </div>
          </div>
          <p style='margin-top:12px; color:var(--muted)'>This is a modal roadmap for the year ‚Äî you can replace with dynamic data and integrate with your product planning API.</p>`;
      }

      else if(key==='dependencies'){
        title.textContent='Cross-team Dependency Map';
        body.innerHTML = `<div class='map-canvas' id='depMap'></div><p style='color:var(--muted)'>Drag nodes to explore dependencies. (demo static map)</p>`;
        setTimeout(()=>renderDepMap(),50);
      }

      else if(key==='blockers'){
        title.textContent='Blockers Heatmap';
        body.innerHTML = `<p style='color:var(--muted)'>Heatmap shows blockers by component / team.</p>
          <div style='display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap'>
            <div style='flex:1; min-width:320px'>
              <div id='bigHeat' class='heatmap' style='grid-template-columns:repeat(6,48px)'></div>
            </div>
            <div style='width:260px'>
              <h4>Legend</h4>
              <div style='display:flex; gap:8px; align-items:center'><div style='width:18px;height:18px;background:#ff4d4f;border-radius:4px'></div><span>Critical</span></div>
              <div style='display:flex; gap:8px; align-items:center;margin-top:6px'><div style='width:18px;height:18px;background:#ff944d;border-radius:4px'></div><span>High</span></div>
              <div style='display:flex; gap:8px; align-items:center;margin-top:6px'><div style='width:18px;height:18px;background:#ffd24d;border-radius:4px'></div><span>Medium</span></div>
              <div style='display:flex; gap:8px; align-items:center;margin-top:6px'><div style='width:18px;height:18px;background:#b3e59a;border-radius:4px'></div><span>Low</span></div>
            </div>
          </div>`;
        setTimeout(()=>renderBigHeat(),30);
      }

      else if(key==='risks'){
        title.textContent='Risk Indicators & Alerts';
        body.innerHTML = `<p style='color:var(--muted)'>Active alerts and thresholds.</p>
          <table>
            <thead><tr><th>Risk</th><th>Severity</th><th>Owner</th><th>Action</th></tr></thead>
            <tbody id='riskTable'></tbody>
          </table>
          <div style='margin-top:12px'><button onclick='ackAll()'>Acknowledge All</button></div>`;
        setTimeout(()=>renderRisks(),10);
      }

      else if(key==='product-status'){
        title.textContent='Product Status (Circular Chart)';
        body.innerHTML = `<canvas id='productStatusLarge' width='600' height='300'></canvas><p style='color:var(--muted)'>Shows percent complete, quality and confidence.</p>`;
        setTimeout(()=>drawProductChart('productStatusLarge'),30);
      }

      else if(key==='users'){
        title.textContent='User Management';
        body.innerHTML = `<p style='color:var(--muted)'>Manage users, roles and permissions (roles assigned at signup).</p>
          <div style='display:flex; gap:12px; align-items:flex-start'>
            <div style='flex:1'>
              <table><thead><tr><th>Email</th><th>Role</th></tr></thead><tbody id='userTable'></tbody></table>
            </div>
            <div style='width:260px'>
              <h4>Add User</h4>
              <p style="font-size:13px; color:var(--muted)">Use the sign up form to add new users.</p>
            </div>
          </div>`;
        setTimeout(()=>renderUsers(),10);
      }

      modal.style.display='flex';
    }

    function closeModal(){ document.getElementById('modal').style.display='none'; }
    window.onclick = function(e){ if(e.target===document.getElementById('modal')) closeModal(); }

    function saveIntegration(name){ localStorage.setItem('horizia_int_'+name, 'saved'); alert(name+' saved (demo)'); closeModal(); }

    let productChart=null;
    function drawProductChart(canvasId='productStatus'){
      const canvas = document.getElementById(canvasId);
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      if(productChart) try{ productChart.destroy() }catch(e){}
      const data = { labels:['Complete','In Progress','At Risk'], datasets:[{ data:[55,30,15], backgroundColor:['#60a5fa','#fbbf24','#fb7185'], hoverOffset:4 }] };
      productChart = new Chart(ctx, { type:'doughnut', data, options:{ plugins:{ legend:{ position:'bottom' } }, cutout:'65%'} });
    }

    function renderMiniHeat(){ const container = document.getElementById('miniHeat'); if(!container) return; container.innerHTML=''; const vals = [1,2,3,2,1,0,2,3,1,1,2,3]; vals.forEach(v=>{ const div=document.createElement('div'); div.className='heatcell'; div.style.background = heatColor(v); div.textContent = v>0? v:''; container.appendChild(div); }); }
    function renderBigHeat(){ const container=document.getElementById('bigHeat'); if(!container) return; container.innerHTML=''; const vals = Array.from({length:36}).map(()=> Math.ceil(Math.random()*4) ); vals.forEach(v=>{ const d=document.createElement('div'); d.className='heatcell'; d.style.background=heatColor(v); d.textContent = v>0? (v>3?'!':v):''; container.appendChild(d); }); }
    function heatColor(v){ if(v>=4) return '#ff4d4f'; if(v===3) return '#ff944d'; if(v===2) return '#ffd24d'; if(v===1) return '#b3e59a'; return '#e6eef9'; }

    function renderDepMap(){ const c = document.getElementById('depMap'); if(!c) return; c.innerHTML=''; const nodes = [ {id:'A',x:80,y:80,label:'Payments'}, {id:'B',x:240,y:40,label:'Auth'}, {id:'C',x:420,y:120,label:'UI'}, {id:'D',x:320,y:220,label:'API'}, {id:'E',x:140,y:220,label:'Infra'} ]; const svgNS = 'http://www.w3.org/2000/svg'; const svg = document.createElementNS(svgNS,'svg'); svg.setAttribute('width','100%'); svg.setAttribute('height','420'); svg.setAttribute('viewBox','0 0 600 420'); const edges = [['A','D'],['B','A'],['B','D'],['D','C'],['E','D']]; edges.forEach(e=>{ const n1 = nodes.find(n=>n.id===e[0]); const n2 = nodes.find(n=>n.id===e[1]); const line = document.createElementNS(svgNS,'line'); line.setAttribute('x1',n1.x); line.setAttribute('y1',n1.y); line.setAttribute('x2',n2.x); line.setAttribute('y2',n2.y); line.setAttribute('stroke','#cbd5e1'); line.setAttribute('stroke-width','3'); svg.appendChild(line); }); nodes.forEach(n=>{ const g = document.createElementNS(svgNS,'g'); g.setAttribute('transform',`translate(${n.x-18},${n.y-18})`); const rect = document.createElementNS(svgNS,'rect'); rect.setAttribute('width','140'); rect.setAttribute('height','36'); rect.setAttribute('rx','8'); rect.setAttribute('fill','#fff'); rect.setAttribute('stroke','#e6eef9'); rect.setAttribute('x','0'); rect.setAttribute('y','-12'); rect.setAttribute('style','filter:drop-shadow(0 6px 10px rgba(2,6,23,0.06))'); const text = document.createElementNS(svgNS,'text'); text.setAttribute('x','10'); text.setAttribute('y','12'); text.setAttribute('font-size','12'); text.setAttribute('fill','#0f172a'); text.textContent = n.label; g.appendChild(rect); g.appendChild(text); svg.appendChild(g); makeDraggable(g, svg); }); c.appendChild(svg); }
    function makeDraggable(element, svg){ let isDown=false; let offsetX=0, offsetY=0; element.addEventListener('mousedown', (e)=>{ isDown=true; const transform = element.getAttribute('transform') || 'translate(0,0)'; const match = transform.match(/translate\((-?\d+\.?\d*),\s*(-?\d+\.?\d*)\)/); if(match){ offsetX = e.clientX - parseFloat(match[1]); offsetY = e.clientY - parseFloat(match[2]); } }); window.addEventListener('mousemove', (e)=>{ if(!isDown) return; const x = e.clientX - offsetX; const y = e.clientY - offsetY; element.setAttribute('transform', `translate(${x},${y})`); }); window.addEventListener('mouseup', ()=>{ isDown=false; }); }

    function renderRisks(){ const table = document.getElementById('riskTable'); if(!table) return; const risks = [ {id:1,name:'Payment gateway latency',sev:'High',owner:'dan'},{id:2,name:'Auth token expiry issue',sev:'Critical',owner:'bob'},{id:3,name:'API rate limits',sev:'Medium',owner:'carol'} ]; table.innerHTML=''; risks.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${r.name}</td><td>${r.sev}</td><td>${r.owner}</td><td><button onclick="ack(${r.id})">Acknowledge</button></td>`; table.appendChild(tr); }); }
    function ack(id){ alert('Acknowledged risk '+id); }
    function ackAll(){ alert('All risks acknowledged (demo)'); }

    // RENDER USERS: Only shows users who have signed up (from localStorage roles).
    function renderUsers(){ 
      const tbl=document.getElementById('userTable'); 
      if(!tbl) return; 
      tbl.innerHTML='';
      for(let i in localStorage){
        if(i.startsWith('horizia_role_')){
          const email = i.replace('horizia_role_','');
          const role = localStorage.getItem(i);
          const tr=document.createElement('tr');
          tr.innerHTML = `<td>${email}</td><td>${role}</td>`;
          tbl.appendChild(tr);
        }
      }
    }

    function toggleChat(){
      if(typeof chatOpen === 'undefined') chatOpen = false;
      chatOpen = !chatOpen;
      const chatbox = document.getElementById('chatbox');
      if(chatbox) chatbox.style.display = chatOpen? 'flex':'none';
    }
    function addMessage(sender,text){ const el=document.createElement('div'); el.className='msg '+(sender==='user'?'user':'ai'); el.textContent=text; const box=document.getElementById('chatbox-messages'); if(box) { box.appendChild(el); box.scrollTop = box.scrollHeight; } }
    async function sendMessage(){ const input=document.getElementById('chatInput'); if(!input) return; const txt = input.value.trim(); if(!txt) return; addMessage('user',txt); input.value=''; let reply = 'Sorry, I don\'t know. Try asking about blockers, roadmap or product status.'; const q = txt.toLowerCase(); if(q.includes('blocker')||q.includes('blocks')) reply = 'There are several blockers concentrated in Payments and API. Open Blockers Heatmap for details.'; else if(q.includes('roadmap')) reply = 'Q2: Beta & Integrations. Q4: GA. Open the Delivery Roadmap for a visual timeline.'; else if(q.includes('status')||q.includes('product')) reply = 'Product is ~55% complete, with 15% at risk. Open Product Status for the circular chart.'; else if(q.includes('dependencies')) reply = 'Auth -> Payments -> API -> UI is the main chain. Use Cross-team Map to explore.'; addMessage('ai', reply); }

    function renderBigChartIfOpen(){ if(document.getElementById('productStatusLarge')) drawProductChart('productStatusLarge'); }

    document.addEventListener('DOMContentLoaded', ()=>{
      updateDateTime();
      setInterval(updateDateTime,1000);
      renderMiniHeat();
      drawProductChart();
      // Determine which screen to show
      auth.onAuthStateChanged(function(user){
        if(user && getCurrentUser()){
          showDashboard();
        } else {
          showLandingPage();
        }
      });
    });

  </script>




<!-- ... [existing HTML above] ... -->
<!-- Slack Modal will be opened with openModal('slack') -->
<script>
  // ---------------------- SLACK INTEGRATION ----------------------

  // Save Slack token to localStorage for session (can be improved for security)
  function saveIntegration(name){
    if(name === 'slack'){
      const token = document.getElementById('slackToken').value.trim();
      if(!token) return alert('Provide your Slack Bot token.');
      localStorage.setItem('horizia_int_slack_token', token);
      alert('Slack token saved!');
      closeModal();
    } else {
      localStorage.setItem('horizia_int_'+name, 'saved');
      alert(name+' saved (demo)');
      closeModal();
    }
  }

  // List Slack channels in the modal
  async function listSlackChannels(){
    const token = localStorage.getItem('horizia_int_slack_token');
    if(!token) return;
    const dropdown = document.getElementById('slackChannels');
    if(!dropdown) return;
    dropdown.innerHTML = '<option>Loading...</option>';
    try {
      const resp = await fetch('https://slack.com/api/conversations.list?types=public_channel,private_channel', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      const data = await resp.json();
      if(data.ok && data.channels){
        dropdown.innerHTML = '';
        data.channels.forEach(c=>{
          const opt = document.createElement('option');
          opt.value = c.id;
          opt.textContent = c.name;
          dropdown.appendChild(opt);
        });
      } else {
        dropdown.innerHTML = '<option>Error loading channels</option>';
      }
    } catch(e){
      dropdown.innerHTML = '<option>Error connecting to Slack</option>';
    }
  }

  // Send message to selected Slack channel
  async function sendSlackMessage(){
    const token = localStorage.getItem('horizia_int_slack_token');
    if(!token) return alert('Connect Slack first.');
    const channelId = document.getElementById('slackChannels').value;
    const text = document.getElementById('slackMsg').value;
    if(!channelId || !text) return alert('Select channel and enter message.');
    try {
      const resp = await fetch('https://slack.com/api/chat.postMessage', {
        method: 'POST',
        headers: {
          'Content-Type':'application/json; charset=utf-8',
          'Authorization':'Bearer ' + token
        },
        body: JSON.stringify({ channel: channelId, text: text })
      });
      const data = await resp.json();
      if(data.ok){
        alert('Message sent!');
        document.getElementById('slackMsg').value = '';
      } else {
        alert('Slack error: ' + data.error);
      }
    } catch(e){
      alert('Slack API error: ' + e.message);
    }
  }

  // Enhanced Slack modal loader
  function openModal(key){
    const title = document.getElementById('modalTitle');
    const body = document.getElementById('modalBody');
    const modal = document.getElementById('modal');
    body.innerHTML = '';
    if(key==='slack'){
      title.textContent='Connect & Use Slack';
      body.innerHTML = `
        <div>
          <label style="font-weight:600">Slack Bot Token:</label>
          <input class="input" id="slackToken" placeholder="xoxb-..." style="margin-bottom:8px" />
          <button onclick="saveIntegration('slack')">Save Token</button>
        </div>
        <hr style="margin:12px 0">
        <div style="margin-bottom:8px">
          <label style="font-weight:600">Select Channel:</label>
          <select class="input" id="slackChannels" style="width:100%;margin-bottom:8px"></select>
          <button style="margin-bottom:12px" onclick="listSlackChannels()">Refresh Channels</button>
        </div>
        <div>
          <input class="input" id="slackMsg" placeholder="Message to send" style="margin-bottom:8px" />
          <button onclick="sendSlackMessage()">Send to Slack</button>
        </div>
        <p style="font-size:13px; color:var(--muted); margin-top:8px">
          Your Slack bot token is stored only in your browser session for demo purposes.<br>
          For production, integrate via backend for security.
        </p>
      `;
      modal.style.display='flex';
      // Try to refresh channels if token is present
      setTimeout(()=>{
        if(localStorage.getItem('horizia_int_slack_token')) listSlackChannels();
      },200);
      return;
    }
    // ... [rest of your openModal code for other keys] ...
  }
</script>
<!-- ... [existing HTML below] ... -->



</body>

</html>

